<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Rubik's Cube - Enhanced</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" type="text/css" href="styles.css" />
</head>

<body>
  <div id="info-container" class="ui-panel">
    <h2>Key Bindings</h2>
    <ul>
      <li><i class="fas fa-keyboard"></i> Front: 'F' / Back: 'B'</li>
      <li><i class="fas fa-keyboard"></i> Left: 'L' / Right: 'R'</li>
      <li><i class="fas fa-keyboard"></i> Up: 'U' / Down: 'D'</li>
      <li><i class="fas fa-keyboard"></i> Middle: 'M'</li>
      <li><i class="fas fa-keyboard"></i> Forward: '1' / Reverse: '2'</li>
    </ul>
    <div class="button-group">
      <button class="btn" id="undo-button" onclick="undoLastMove()" data-bs-toggle="tooltip" data-bs-placement="top"
        title="Undo last move">
        <i class="fas fa-undo-alt"></i> Undo
      </button>
      <button class="btn" id="scramble-button" onclick="handleScramble()" data-bs-toggle="tooltip"
        data-bs-placement="top" title="Scramble the cube">
        <i class="fas fa-random"></i> Scramble
      </button>
      <button class="btn" id="solve-button" onclick="handleSolve()" data-bs-toggle="tooltip" data-bs-placement="top"
        title="Solve the cube">
        <i class="fas fa-magic"></i> Solve
      </button>
      <button class="btn" id="reset-button" onclick="resetState()" data-bs-toggle="tooltip" data-bs-placement="top"
        title="Start over">
        <i class="fas fa-refresh"></i> Reset
      </button>
    </div>
  </div>

  <div id="action-display"></div>
  <div id="solution-display"></div>

  <div id="direction-container" class="ui-panel">
    <button id="clockwise-icon" class="btn icon-btn" onclick="setReverse();">
      <i class="fas fa-redo-alt" data-bs-toggle="tooltip" data-bs-placement="left"
        title="Change to counter-clockwise"></i>
    </button>
    <button id="counter-clockwise-icon" class="btn icon-btn" onclick="setReverse();">
      <i class="fas fa-undo-alt" data-bs-toggle="tooltip" data-bs-placement="left" title="Change to clockwise"></i>
    </button>
  </div>

  <div id="canvas"></div>
  <div id="messages-container"></div>

  <!-- Scramble Dialog Modal -->
  <div id="scramble-modal" class="modal fade" tabindex="-1" aria-labelledby="scrambleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="scrambleModalLabel">
            <i class="fas fa-random"></i> Scramble Cube
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="text-muted mb-3">Enter the range for number of random moves:</p>
          <div class="row g-3">
            <div class="col-6">
              <label for="min-moves" class="form-label">Minimum moves</label>
              <input type="number" class="form-control" id="min-moves" min="1" value="10">
            </div>
            <div class="col-6">
              <label for="max-moves" class="form-label">Maximum moves</label>
              <input type="number" class="form-control" id="max-moves" min="2" value="25">
            </div>
          </div>
          <div id="scramble-error" class="alert alert-danger mt-3" style="display: none;"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="start-scramble-btn">
            <i class="fas fa-play"></i> Start Scramble
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Your existing scripts -->
  <script src="js/three.min.js"></script>
  <script src="js/OBJLoader.js"></script>
  <script src="js/SourceLoader.js"></script>
  <script src="js/OrbitControls.js"></script>
  <script src="js/KeyboardState.js"></script>
  <script type="module" src="modules/main.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>

  <script>

    document.addEventListener('DOMContentLoaded', function () {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });

    // Add loading state to solve button
    function handleSolve() {
      const solveButton = document.getElementById('solve-button');
      const originalContent = solveButton.innerHTML;

      solveButton.innerHTML = '<span class="loading-spinner"></span>Solving...';
      solveButton.disabled = true;

      // Call your original solve function here
      // After solving is complete, restore button:
      setTimeout(() => {
        solveButton.innerHTML = originalContent;
        solveButton.disabled = false;
      }, 2000); // Adjust timing as needed
    }

    // Enhanced message display function
    function showMessage(message, type = 'info', duration = 3000) {
      const container = document.getElementById('messages-container');
      const alert = document.createElement('div');
      alert.className = `alert alert-${type} alert-dismissible fade show`;
      alert.innerHTML = `
          <strong>${type === 'success' ? '✓' : type === 'danger' ? '✗' : 'ℹ'}</strong> ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

      container.appendChild(alert);

      setTimeout(() => {
        alert.classList.add('fade-out');
        setTimeout(() => {
          if (alert.parentNode) {
            alert.parentNode.removeChild(alert);
          }
        }, 500);
      }, duration);
    }

    // Scramble functionality
    function handleScramble() {
      const modal = new bootstrap.Modal(document.getElementById('scramble-modal'));
      modal.show();
    }

    // Validation and scramble execution
    document.addEventListener('DOMContentLoaded', function () {
      const startScrambleBtn = document.getElementById('start-scramble-btn');
      const minMovesInput = document.getElementById('min-moves');
      const maxMovesInput = document.getElementById('max-moves');
      const errorDiv = document.getElementById('scramble-error');
      const modal = document.getElementById('scramble-modal');

      startScrambleBtn.addEventListener('click', function () {
        const minMoves = parseInt(minMovesInput.value);
        const maxMoves = parseInt(maxMovesInput.value);

        // Validation
        errorDiv.style.display = 'none';

        if (isNaN(minMoves) || isNaN(maxMoves)) {
          showError('Please enter valid numbers for both fields.');
          return;
        }

        if (minMoves < 1) {
          showError('Minimum moves must be at least 1.');
          return;
        }

        if (maxMoves <= minMoves) {
          showError('Maximum moves must be greater than minimum moves.');
          return;
        }

        // Hide modal and start scrambling
        const modalInstance = bootstrap.Modal.getInstance(modal);
        modalInstance.hide();

        executeScramble(minMoves, maxMoves);
      });

      function showError(message) {
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
      }
    });

    // Add some example interactions
    document.addEventListener('keydown', function (e) {
      if (['F', 'B', 'L', 'R', 'U', 'D', 'M', '1', '2'].includes(e.key.toUpperCase())) {
        const actionDisplay = document.getElementById('action-display');
        actionDisplay.textContent = e.key.toUpperCase();
        actionDisplay.style.animation = 'none';
        setTimeout(() => {
          actionDisplay.style.animation = 'pulse 2s infinite';
        }, 10);
      }
    });
  </script>
</body>

</html>